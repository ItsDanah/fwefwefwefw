package project212;

public class Orders {

	// Static list holding all orders made in the system
	private static LinkedList<Orders> orders = new LinkedList<>();

	// Each order contains its own list of products
	private LinkedList<Products> productsList;

	// attributes
	private int orderId;		 // ID of the order
	private int customerId;      // ID of the customer who made the order
	private Customers customer;  // reference to the customer object
	private double totalPrice;   // total cost of all products in this order
	private String orderDate;    // format: YYYY-MM-DD
	private String status;       // status of the order: Canceled, Pending, etc...

	// Constructor:
	public Orders(int orderId, int customerId, double totalPrice, String orderDate, String status) {
		this.orderId = orderId;             
		this.customerId = customerId;       
		this.totalPrice = totalPrice;       
		this.orderDate = orderDate;        
		this.status = status;              
		this.productsList = new LinkedList<>();
	}

	//----------------------------------------------------------------------------------//
	// Create a new order in the system 
	public void createOrder(Orders order) {

		// Check if an order with the same ID exists in the system
		if (searchById(order.getOrderId()) != null) {
			System.out.println("Order already exists");
			return;
		}

		// Add the new order to the static orders list
		orders.insert(order);

		// Add the order to the customer's own order list
		if (order.getCustomer() != null) {
			order.getCustomer().placeOrder(order);  // To link the customer to his order list
		} else {
			System.out.println("Order has no associated customer");
		}

	}

	//----------------------------------------------------------------------------------//
	// Cancel an existing order (only if still pending)

	public static void cancelOrder(int orderId) {
		// Find order by ID
		Orders canceledOrder = searchById(orderId);

		if (canceledOrder == null) {
			System.out.println("No order found with this ID");
			return;
		}

		// Only pending orders can be canceled
		if (!canceledOrder.getStatus().equalsIgnoreCase("Pending")) {
			System.out.println("You can't cancel an order after it has been shipped");
			return;
		}

		// Set order status to "Canceled"
		canceledOrder.setStatus("Canceled");
		System.out.println("Order canceled successfully");
	}

	//----------------------------------------------------------------------------------//
	// Update the status of an order

	public static void updateStatus(int orderId, String status) {
		// Find the order by id
		Orders updatedOrder = searchById(orderId);

		if (updatedOrder == null) {
			System.out.println("No order found with this ID");
			return;
		}

		// Set order status
		updatedOrder.setStatus(status);
		System.out.println("Order status updated successfully");
	}

	//----------------------------------------------------------------------------------//
	// Search for an order by id

	public static Orders searchById(int orderId) {
		if (orders.empty()) // if no orders exist
			return null; 

		orders.findFirst();
		while (!orders.last()) {   // Go through the list until we find the matching order ID
			if (orders.retrieve().getOrderId() == orderId)
				return orders.retrieve(); 
			orders.findNext();   
		}

		// Check for the last order in the list
		if (orders.retrieve().getOrderId() == orderId)
			return orders.retrieve();

		return null;
	}

	//----------------------------------------------------------------------------------//
	// Get all orders made between two dates in the format YYYY-MM-DD

	public static LinkedList<Orders> getOrdersBetweenDates(String date1, String date2) {
		LinkedList<Orders> ordersBetweenDates = new LinkedList<>(); // A new list to hold matching orders

		if (orders.empty()) 
			return ordersBetweenDates;

		// Edit both date strings into integers for comparison
		int d1 = Integer.parseInt(date1.replace("-", ""));
		int d2 = Integer.parseInt(date2.replace("-", ""));

		orders.findFirst();
		while (true) {
			String date = orders.retrieve().getOrderDate();
			int d = Integer.parseInt(date.replace("-", "")); 
			if (d >= d1 && d <= d2)  // If order date is between date1 and date2 add it to the list
				ordersBetweenDates.insert(orders.retrieve());
			if (orders.last()) 
				break; 
			orders.findNext();
		}
		return ordersBetweenDates;
	}

	//----------------------------------------------------------------------------------//

	public String toString() {
		String productIds = "No products";

		if (!productsList.empty()) { // Collect all product IDs if the list is not empty
			productIds = "";
			productsList.findFirst();

			while (!productsList.last()) {
				productIds += productsList.retrieve().getProductId() + ";";
				productsList.findNext();
			}
			productIds += productsList.retrieve().getProductId(); // Add the last product
		}

		return "Order ID: " + orderId +" || Customer ID: " + customerId +" || Products: " + productIds +" || Total Price: " + totalPrice +" || Order Date: " + orderDate +" || Status: " + status;
	}

	//----------------------------------------------------------------------------------//
	// Getters and setters
	public int getOrderId() { 
		return orderId;}

	public int getCustomerId() { 
		return customerId; }

	public Customers getCustomer() { 
		return customer; }

	public void setCustomer(Customers customer) { 
		this.customer = customer; }

	public double getTotalPrice() { 
		return totalPrice; }

	public void setTotalPrice(double totalPrice) { 
		this.totalPrice = totalPrice; }

	public String getOrderDate() { 
		return orderDate; }

	public void setOrderDate(String orderDate) { 
		this.orderDate = orderDate; }

	public String getStatus() { 
		return status; }

	public void setStatus(String status) { 
		this.status = status; }

	public LinkedList<Products> getProductsList() { 
		return productsList; }

	public void setProductsList(LinkedList<Products> productsList) { 
		this.productsList = productsList; }

	public static LinkedList<Orders> getOrders() { 
		return orders; }

}
